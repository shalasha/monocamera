# monocamera

Программа распознает желтые предметы и находит до них расстояние. Необходимо изначально знать 
ширину предмета. 
При первом запуске, чтобы узнать фокальное расстояние, необходимо изменить строчку в first_run.py


![4-01](https://user-images.githubusercontent.com/101719007/161603735-e453a9d2-e15d-461a-9caf-3900464663a8.jpg)


Расположение файла: 

/home/nvidia/Anna/first_run.py

Открываем файл в текстовом редкторе и изменяем значение на ширину вашего объекта в см, а также расстояние до него:

W = 6.3  #ширина вашего объекта в см

d = 15   #расстояние между объектом и камерой в см

Переменную d мы задаём сами, выставив камеру ровно на это расстояние до предмета.

Сохраняем изменения и запускаем файл.

Запуск: 

Написать в консоли

cd /home/nvidia/Anna/

python monocamera_distance.py

В консоли отобразится значение f - фокусное расстояние. 

![image](https://user-images.githubusercontent.com/101719007/161546059-48828a74-6305-4de5-b14a-a484fe5f7526.png)

Чтобы выйти из программы, нужно нажать 'q'

Теперь имея значение фокального расстояния, мы можем перейти к программе определения расстояния до предмета. 

Расположение файла: 

/home/nvidia/Anna/monocamera_distance.py

Открываем monocamera_distance.py в файловом редакторе и изменяем значение f:

f = 442.8571428571429 #focal length

Запуск: 

Написать в консоли

python monocamera_distance.py

1) Алгоритм работы программы 

![2_Монтажная область 1](https://user-images.githubusercontent.com/101719007/161603133-c97f386e-8372-418b-85cc-818baa67f941.jpg)

(7.04. 2022)
Задача определения местоположения 
![image](https://user-images.githubusercontent.com/101719007/162430042-45f24561-7704-4b85-bc31-42784f5ddc5a.png)

Запуск файдла:

python monocamera_distance3.py

Красными точками отображаюются два знака. 
Зелёной - трек перемещений веб-камеры. 
На данный момент местоположение определяется неточно, так как необходимо расчитать масштаб размера окна в пикселях относительно реального полигона. И соответсвтенно перевести все значения расстояния от объекта до камеры в миллиметры. Также необходимо доработать координатную плоскость (добавить квадраты) и сделать полигон с  соблюдением масштаба.

(11.04.2022)

В комнате поменялось освещение, поэтому пришлось настраивать границы цветов HSV для кругов заново. 

Новые границы для желтого:

![image](https://user-images.githubusercontent.com/101719007/162704746-188f6b4e-9c50-49fb-8c76-ce4a79ae4ed9.png)

Новые границы для зелёного:

![image](https://user-images.githubusercontent.com/101719007/162706023-0160e48c-069e-4c96-9b21-f7a81a589ac8.png)

Пример работы программы monocamera_distance4.py: 

![image](https://user-images.githubusercontent.com/101719007/162742122-99f534b0-e206-45e3-9b93-e16e93b2aa48.png)

Из-за слабой камеры неточно определяется цветовое пятно, что приводит к неточным подсчетам расстояния и координат. 
При наиулучшем положении камеры, когда расстояние определялось верно, погрешность по оси x и y составляла около 2-3 сантиметров. 


Размер полигона: 832 мм на 1150 мм. 

![image](https://user-images.githubusercontent.com/101719007/162813497-38243ea3-5d1c-46d6-9206-c393c6f3028a.png)

![image](https://user-images.githubusercontent.com/101719007/162813468-b350d7aa-9df7-4e82-a4c5-1815bd7d673b.png)

Координата (0,0) находится в верхнем левом углу относительно камеры. 

Было принято решение заменить цветные круги на QR-коды. 

Для распознования QR-кодов необходимо установить библиотеку:

pip install pyzbar

Демонстрация работы программы QR.py

![image](https://user-images.githubusercontent.com/101719007/162758051-93ff5d59-1904-4ee6-b47b-4dad1f5d8971.png)


Демонстрация работы программы monocamera_distance5.py:

![image](https://user-images.githubusercontent.com/101719007/162765328-3f701719-aae9-47cb-ab13-c36fdf50601c.png)

Скачки координат значительно уменьшились, но тест на ноутбуке показал, что коды распознаются намного лучше с веб-камерой с более четкой картинкой. 

